---
layout:		post
title:		DVWA
subtitle:   学习学习
date:		2020-12-01
author:		lll-yz
header-img: img/post-bg-coffee.jpg
catalog: 	true
tage:
	-学习
---

#### Command Injection 

命令连接符：

```
command1 && command2 先执行command1，若command1正确则执行command2，否则被执行command2
command1 & command2 先执行command1，无论command1成不成功都执行command2
command1 || command2 先执行command1，若command1成功则不执行command2，反之执行command2
command1 | command2 只执行command2
```



#####  low

```
<?php

if( isset( $_POST[ 'Submit' ]  ) ) {
    // Get input
    $target = $_REQUEST[ 'ip' ];

    // Determine OS and execute the ping command.
    if( stristr( php_uname( 's' ), 'Windows NT' ) ) {
        // Windows
        $cmd = shell_exec( 'ping  ' . $target );
    }
    else {
        // *nix
        $cmd = shell_exec( 'ping  -c 4 ' . $target );
    }

    // Feedback for the end user
    echo "<pre>{$cmd}</pre>";
}

?> 
```

相关函数学习：

 + $_REQUEST  HTTP request 变量，默认包括了 $_GET, $_POST, $_COOKIE数组。

 + stristr(string,search,before_search) : stristr函数搜索字符串在另一字符串的第一次出现，返回字符串的剩余部分（从匹配点），如果未找到所搜索的字符串，则返回false。

    参数string规定被搜索的字符串，search规定要搜索的字符串（如果该参数是数字，则搜索匹配该数字对应的ASCII值的字符），可选参数before_search为布尔型，默认为“false”，如果设置为“true”，函数将返回search参数第一次出现之前的字符串部分。

+ php_uname(mode) : 该函数会返回运行php的操作系统的相关描述，参数mode可取值 "a" (此为默认，包含序列"s n r v m" 里的所有模式) ，"s"(返回操作系统名称) , "n"(返回主机名),  "r"(返回版本名称),  "v"(返回版本信息),  "m"(返回机器类型)。

+ shell_exec(cmd) : 在外部执行一个命令，参数cmd即为要执行的命令。

  

  因此得出服务器对操作系统执行Linux系统的ping命令，如果不是Windows NT系统则执行Linux系统的ping命令。

  由于未对IP参数做任何过滤，导致有注入漏洞。

  输入 127.0.0.1 && ipconfig ：

  ![](https://imgchr.com/i/DjNMKU)

##### Medium

```
<?php

if( isset( $_POST[ 'Submit' ]  ) ) {
    // Get input
    $target = $_REQUEST[ 'ip' ];

    // Set blacklist
    $substitutions = array(
        '&&' => '',
        ';'  => '',
    );

    // Remove any of the charactars in the array (blacklist).
    $target = str_replace( array_keys( $substitutions ), $substitutions, $target );

    // Determine OS and execute the ping command.
    if( stristr( php_uname( 's' ), 'Windows NT' ) ) {
        // Windows
        $cmd = shell_exec( 'ping  ' . $target );
    }
    else {
        // *nix
        $cmd = shell_exec( 'ping  -c 4 ' . $target );
    }

    // Feedback for the end user
    echo "<pre>{$cmd}</pre>";
}

?> 
```

```
$substitutions = array(
        '&&' => '',
        ';'  => '',
    );
```

设置了黑名单，将 && 和 ; 替换为空。

1.因为只有 && 与 ; 被过滤，所以可以使用 127.0.0.1 & net user

（net user  查看有哪些用户）

![](img\command2.png)

2.也可以用 127.0.0.1 &;& ipconfig 绕过。

